# 云计算

## 第一章 云计算概念和价值

### 云计算的关键特征

* 按需自助服务
* 无处不在的网络接入
* 与位置无关的资源池
* 快速弹性
* 按使用付费

### 技术视角：云计算=计算/存储的网络

云计算是通过网络把海量的服务器和存储进行组网并使用云平台软件对硬件设备虚拟化以支撑上层业务和应用运行的应用网络。

云计算包含两个部分：云设备和云服务。
* 云设备：用于提供资源的海量的服务器和存储以及交换机。
* 云服务：用于把资源进行池化的云平台软件以及给上层提供服务的云管理软件和业务应用软件。

云计算技术的发展趋势：
* 海量低成本服务器代替专有大型机、小型机、高端服务器。
* 分布式软件代替传统单机操作系统。
* 自动管控软件代替传统集中管理。

### 商业视角：云计算=信息电厂

* 计算和存储：从局域网向互联网迁移
* 软件：从终端向云端迁移
* 软件和硬件解耦，实现硬件共享

### 云计算产生的背景

* 需求推动
* 技术进步
* 商业模式转变

### 云计算的演进历程

* 并行计算：所有的计算任务在一台计算设备里面进行处理，把一个大的任务分成多个进程进行处理。

* 分布式计算：把分布在各地的计算设备通过网络组合成一个统一的计算模式，要求各地的计算设备是同构的。

* 网格计算：分布式计算的一个发展，分布于各地的计算设备可以是不同构的。

* 云计算

### 云计算的部署模式

* 私有云：提供者和使用者相同。
* 公有云：云服务提供者和使用者不同。
* 混合云：两种模式的混合。

### 云计算的商业模式

IaaS：基础设施即服务，指的是把基础设备以服务形式提供给最终用户使用。包括计算、存储、网络和其他的计算资源，用户可以部署和运行任意软件，包括操作系统和应用程序。
PaaS：平台即服务，指的是把二次开发的平台以服务形式提供给最终用户使用，客户不需要管理或控制底层的云计算基础设施，但能控制部署的应用程序开发平台。
SaaS：软件即服务，提供给消费者的服务是运行在云计算基础设备上的应用程序。

### 行业客户反应的困难与挑战

* 复杂性与平滑过渡
* 可靠性或SLA
* 工作负载可迁移性
* 数据安全性
* 厂商锁定
* 看不到投资回报

### 云计算的价值——智能资源调度

* 负载均衡
* 热迁移实现节能减排

### 云计算的价值——提高资源利用率

* 资源共享
* 分时共享

### 云计算的价值——分布式计算存储

* 动态加入和撤出

### 云计算的价值——统一管理

### 云计算的价值——业务快速部署

* 减少业务部署时间

### 虚拟化的起源

* 60年代在大型机上虚拟技术已经有所应用
* 99年在小型机上已经出现逻辑分区的应用
* 2000年x86平台虚拟技术开始出现
* 2001年x86平台虚拟化技术在服务器上应用

### 虚拟化技术推动力

* CPU速度越来越快，超出软件对硬件性能的要求
* Intel和AMD在CPU里加入虚拟指令
* 企业成本压力
* 环保压力
* 不断增长的业务压力

### 虚拟化的概念

* 虚拟化是指通过虚拟化技术将一台计算机虚拟为多台逻辑计算机，在一台计算机上同时运行多个逻辑计算机，每个逻辑计算机可运行不同的操作系统，并且应用程序都可以在相互独立的空间内运行而互不影响，从而显著提高计算机的工作效率。

### 虚拟化的主要内容

* 计算虚拟化
  * CPU虚拟化
  * 内存虚拟化
  * I/O虚拟化
* 存储虚拟化
  * 裸设备 + 逻辑卷
  * 存储设备虚拟化
  * 主机存储虚拟化 + 文件系统
* 网络虚拟化
  * VPN
  * VLAN

### 虚拟化的本质

* 分区：在单一物理服务器上可同时运行多个虚拟机，按需使用硬件资源池中的资源
* 隔离：每个虚拟机之间都是隔离的，业务互不影响
* 封装：整个虚拟机的执行环境封装在独立的文件中，可以通过移动和复制这些文件来移动和复制虚拟机
* 独立：相对于硬件独立，虚拟机无需任何修改可在任何物理服务器上运行实现热迁移

## 第二章 OpenStack基础原理

### OpenStack起源

* 计算服务Nova
* 对象存储服务Swift
* 镜像服务Glance
* 网络服务Neutron
* 身份认证服务Keystone
* 计量服务Celimeter
* 块存储服务Cinder
* 编排服务Heat

### OpenStack架构

* Keystone
  * 身份服务
  * 管理用户，租户，角色，服务和服务端点
  * 可以支持SQL，PAM，LDAP作为后端
* Nove
  * 计算服务
    * 计算节点——运行虚拟机的hypervisor
  * 分布式控制器
    * 负责处理器调度策略及API调用等
* Glance
  * 镜像服务
  * 镜像格式：raw，qcow，vhd，vmdk，iso
  * 后端存储：swift，filesystem，AmazonS3
* swift
  * 对象存储服务
  * 提供存取数据的易用服务
* Neutron
  * 网络服务
  * 提供支持/实现SDN框架
  * 基于插件的模型
* cinder
  * 块存储服务（卷服务）
  * 持久化磁盘
  * 基于插件的架构便于扩展
* horizon
  * 仪表板
  * 自服务界面
  * 基于云管理功能
* ceilometer
  * 提供openstack平台组件的监控
  * 计量服务

### Nova介绍

* OpenStack云中的计算组织控制器
* 管理OpenStack云中实例的生命周期
* 管理计算资源、网络、认证所需的可扩展性平台

* KVM：
  * 内核虚拟化，OpenStack默认的Hypersvisor
* Qemu：
  * KVM的替补角色，没有KVM执行效率高，不支持全虚拟化
* Flavor：
  * 新建虚拟机的配置列表，虚拟机模板
* Keypair：
  * ssh连接访问实例的密钥对
* 安全组：
  * 用来控制实例访问策略的容器
* 安全组规则：
  * 用来控制实例访问的具体策略

### Nova架构

* API：提供统一风格的restful API接口，作为入坑，接收用户请求
* SCHEDULER：负责调度，将实例分配到具体的计算节点
* CONDUCTOR：主要负责与Nova数据库交互
* COMPUTE：运行在计算节点上，用于虚拟机实例的创建和管理
* MESSAGE QUEUE：组件间的数据传递

### Nova功能特性

* 实例的生命周期管理
* 管理平台的计算资源
* 统一风格的RestAPI
* 支持透明的hypervisor
* 各个模块通过消息队列实现交互

### Swift简介

* 高可用分布式对象存储
* 为Nova组件提供虚拟机镜像存储
  * 无需采用raid，通过在软件层面引入一致性散列技术和数据冗余，牺牲一定程度的数据一致性来达到高可用和可伸缩性
  * 支持多租户模式下容器和对象读写操作
* 适用于互联网应用场景下非结构化数据存储

### 常用术语：

* Account：
  * 用户定义的管理存储区域
* Container：
  * 存储隔间，类似于文件夹或目录
* Object：
  * 包含了基本的存储实体和它自身的元数据
* Ring：
  * 记录了磁盘上存储的实体名称和物理位置的映射关系
* Region：
  * 地域，从地理位置上划分的一个概念
* Zone：
  * 可用区，按照独立的供网、供电基础设施划分。
* Node：
  * 节点，存储服务器
* Disk：
  * 磁盘，物理服务器上的存储设备
* Cluster：
  * 群集，为冗余考虑的部署架构

### Swift功能

* Swift在物理结构上往往会存储对象的多个副本，通常按照物理位置的特点，将对象拷贝到不同的物理位置上，来保证数据的可靠性


### Keystone简介

* 提供身份验证、服务规则和服务令牌功能
* 任何服务之间相互调用，都需要经过Keystone的身份验证

### 常用术语

* User：
  * OpenStack最基本的用户。
* Project：
  * 指分配给使用者的资源的集合。
* Role：
  * 代表一组用户可以访问资源的权限。
* Domain：
  * 定义管理边界，可以包含多个project/tenant、user、role等。
* Endpoint：
  * 服务的URL路径，暴露出来的访问点

### Neutron简介

* 提供网络服务的核心组件
* 基于软件定义网络的思想
  * 实现上充分使用Linux系统中各种网络相关技术
  * 支持第三方插件

### 常用术语

* Bridge-int:
  * 实现内部网络功能的网桥
* Br-ex:
  * 跟外部网络通信的网桥
* Neutron-server：
  * 提供API接口
* Neutron-L2-agent：
  * 实现二层网络通信的代理
  * 用于管理vlan的插件，接受Neutron-server的指令来创建VLAN
* Neutron-DHCP-agent:
  * 为子网自动分发IP地址
* Neutron-L3-agent:
  * 租户网络和floating IP间地址转换
* Neutron-metadata-agent:
  * 响应Nova的metadata请求
* LBaaS agent：
  * 为多台实例和open vswitch agent提供负载均衡服务
